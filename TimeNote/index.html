<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeNote</title>
    <style>
        body {
            background-color:black;
            margin:0;
        }
        #backGroundImage {
            background-image:url("s.png");
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
            background-size: 60%;
            position: absolute;
            top: 0px;
            right: 0px;
            bottom: 0px;
            left: 0px;
            opacity: 0.05;
        }
        #app {
            position: absolute; 
            height: 100vh;
            width: 100vw;
            top: 0px;
            right: 0px;
            bottom: 0px;
            left: 0px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction:column;
            font-family:Garamond;
        }
        .note {
            color:red;
            min-width:400px;
            min-height:50px;
            width:75vw;
            height:4vw;
            margin:5px 0;
            border:1px solid rgba(255,255,255,.3);
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
        .deleteNote {
            cursor:pointer;
        }
        .timerDisplay {
            display: flex;
            justify-content: space-between;
            width:120px;
        }
        .timerDisplay > * {cursor:pointer;}
        .pause{
            height:11px;
            transform:translatey(30%);
        }
    </style>
</head>
<body>
    <div id="backGroundImage"></div>
    <div id="app"></div>
</body>
<script>
                                        //will add:
                                        //toggle night/day button
                                        //add note button
                                        // alarm av pÃ¥ ðŸ”‡ðŸ”Š
                                        //klikk pÃ¥ "tidspunkt:" for Ã¥ bytte til "countdown:".
                                        //klikk pÃ¥ "countdown:" for Ã¥ bytte til "tidspunkt:".
                                        //relevant bakgrunnsbilde.
    model = {
        currentTime: new Array(4),
        alarms: {
            default: "",
        },
        notes: [
            {
                description: "Note 1",
                alarm: "",                      // if there is one this will be added to the note.
                endTime: [0,0,0,0],             // 
                totalTime: [0,0,0,0],           // 
                timeRemaining: [0,0,0,0],       // [hour,min,sec,ms]
                html: "",                       // this note's html.
                started: false,
                countdown: true,
                editDescription: false,
                editTime: false,
                editcountdownTime: false,
            },{
                description: "Note 2",
                alarm: "",                      // if there is one this will be added to the note.
                endTime: new Array(4),          // 
                totalTime: [0,0,0,0],           // 
                timeRemaining: [0,0,0,0],       // [hour,min,sec,ms]
                html: "",                       // this note's html.
                started: false,
                countdown: true,
                editDescription: false,
            }
        ]
    }
    
    show();
    function show(){
        let html = '';
        for (i in model.notes){
            html +=`
            <div class="note">`;

                if (model.notes[i].editDescription) html += `<input type="text" class="description" value="${model.notes[i].description}" onchange="setDescription(this,${i})"></input>`
                else html += `<div class="description" onclick="editDescription(${i})">${model.notes[i].description}</div>`;

            html +=`
            <div class="timerDisplay">`;

                if (model.notes[i].editcountdownTime) html+= `
                    <input class="time" type="time" step="1" value="00:00:00" onchange="setTimeRemainingCountdown(this.value,${i})"></input>`;
                else html += `
                    <div class="resetCountdown" onclick="resetCountdown(${i})">â†»</div>
                    <img class="pause" src="pause.svg" alt="pause-button" onclick="startStopCountdown(${i})"></img>
                    <div class="time" onclick="editCountdown(${i})">${getCountdownText(i)}</div>`;

            html +=`
                </div>
                <div class="deleteNote" onclick="deleteNote(${i})">x</div>
            </div>
            `;
        }
        document.getElementById('app').innerHTML=html;
    }

    //setInterval(updateTimers,100)
    function updateTimers(){
        updateCurrentTime();
        for (i in model.notes){
            let note = model.notes[i];
            if (note.started){
                if (note.countdown) {

                }
            }
        }
    }
    function editDescription(i){
        model.notes[i].editDescription = true;
        show();
    }
    function setDescription(input, i){
        model.notes[i].editDescription = false;
        model.notes[i].description=input.value;
        show();
    }
    function editCountdown(i){
        if (model.notes[i].started) return;
        model.notes[i].editcountdownTime = true;
        show();
    }
    function getCountdownText(i){
        const timeRemaining = model.notes[i].timeRemaining;
        return `${timeRemaining[0]>9?timeRemaining[0]:'0'+timeRemaining[0]}:
                ${timeRemaining[1]>9?timeRemaining[1]:'0'+timeRemaining[1]}:
                ${timeRemaining[2]>9?timeRemaining[2]:'0'+timeRemaining[2]}`;
    }

    // Sets the time reamining for the note's countdown timer.
    function setTimeRemainingCountdown(t,i){
        const totalTime = model.notes[i].totalTime;
        const timeRemaining = model.notes[i].timeRemaining;
        timeRemaining[0] = parseInt(t[0]+t[1]);
        timeRemaining[1] = parseInt(t[3]+t[4]);
        timeRemaining[2] = parseInt(t[6]+t[7]);
        timeRemaining[3] = 0;
        for (let i in timeRemaining) {totalTime[i]=timeRemaining[i];}
        model.notes[i].editcountdownTime = false;
        show();
    }

    // Sets the end time for the note's countdown timer (when the timer is started).
    function setEndTimeCountdown(i){
        updateCurrentTime();                                // temporary just to make the current code work.
        const endTime = model.notes[i].endTime;
        const timeRemaining = model.notes[i].timeRemaining; // won't update since countdown is paused.
        const currentTime = [...model.currentTime];         // copying to avoid changes to model.currentTime mid calculations.
        endTime[0] = timeRemaining[0] + currentTime[0];
        endTime[1] = timeRemaining[1] + currentTime[1];
        endTime[2] = timeRemaining[2] + currentTime[2];
        endTime[3] = timeRemaining[3] + currentTime[3];
        if (endTime[3]>999){endTime[3]-1000;endTime[2]++}
        if (endTime[2]>59) {endTime[2]-60;endTime[1]++}
        if (endTime[1]>59) {endTime[1]-60;endTime[0]++}
        if (endTime[0]>23) {endTime[0]-24}
    }

    function updateTimeRemaining(i){
        updateCurrentTime();                            // temporary just to make the current code work.
        const endTime = model.notes[i].endTime;
        const currentTime = [...model.currentTime];     // copying to avoid changes to model.currentTime mid calculations.
    }

    function startStopCountdown(i){
        const note=model.notes[i];
        if (!note.started && note.countdown) setEndTimeCountdown(i);    // sets end time if countdown.
        note.started ? note.started=false : note.started=true;
        show();
    }

    // Resets countdown by setting time remaining equal to total time.
    function resetCountdown(i){
        const note=model.notes[i];
        const totalTime = note.totalTime;
        const timeRemaining = note.timeRemaining;
        const isStarted=note.started;
        note.started=false;
        for (let i in totalTime) {timeRemaining[i]=totalTime[i];}
        setEndTimeCountdown(i); // updates end time based on time remaining.
        note.started=isStarted;
        show();
    }

    function updateCurrentTime(){
        const d = new Date();
        const currentTime = [d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()]
        for (i in currentTime) model.currentTime[i]=currentTime[i];
    }

    function deleteNote(i){
        model.notes.splice(i,1);
        show();
    }
</script>
</html>